@model IEnumerable<SupportTicketApp.Models.TicketInfoTab>

<h2>Çalışana Atanmış Biletler</h2>

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}

<form asp-action="BulkUpdateTickets" method="post">
    <table class="table table-striped">
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll" /></th>
                <th>Bilet ID</th>
                <th>Başlık</th>
                <th>Açıklama</th>
                <th>Durum</th>
                <th>Öncelik</th>
                <th>Oluşturan Kullanıcı</th>
                <th>Oluşturulma Tarihi</th>
                <th>Resim</th>
                <th>Tamamlanma Durumu</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var ticket in Model)
            {
                <tr>
                    <td>
                        <input type="checkbox" name="ticketIds" value="@ticket.TicketId" />
                    </td>
                    <td>@ticket.TicketId</td>
                    <td>@ticket.Title</td>
                    <td>@ticket.Description</td>
                    <td>@(ticket.Status ? "Aktif" : "Pasif")</td>
                    <td>@ticket.Urgency</td>
                    <td>@(ticket.UserTab?.Name ?? "Atanmamış")</td>
                    <td>@ticket.CreatedDate.ToShortDateString()</td>
                    <td>
                        @if (ticket.TicketImages != null && ticket.TicketImages.Any())
                        {
                            <span>Resim var</span>
                        }
                        else
                        {
                            <span>Resim yok</span>
                        }
                    </td>
                    <td>
                        @if (ticket.IsCompleted)
                        {
                            <span class="text-success">Tamamlandı</span>
                        }
                        else
                        {
                            <span class="text-warning">Devam Ediyor</span>
                        }
                    </td>
                    <td>
                        <a asp-controller="Employee" asp-action="AddComment" asp-route-ticketId="@ticket.TicketId" class="btn btn-info">Detay</a>                    
                        <a asp-controller="Employee" asp-action="ExportToPdf" asp-route-ticketId="@ticket.TicketId" class="btn btn-secondary">PDF İndir</a>


                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div class="mt-3">
        <button type="submit" name="action" value="complete" class="btn btn-success">Tamamlandı</button>
        <button type="submit" name="action" value="delete" class="btn btn-danger">Sil</button>
    </div>
</form>

<script>
    document.getElementById("selectAll").addEventListener("click", function () {
        const checkboxes = document.querySelectorAll("input[name='ticketIds']");
        checkboxes.forEach(cb => cb.checked = this.checked);
    });
</script>
